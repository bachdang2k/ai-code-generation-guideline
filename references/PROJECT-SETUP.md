# Project Setup & Dotfiles Best Practices

> Covers `.gitignore`, `.env` handling, `.editorconfig`, `.gitattributes`, `.dockerignore`, and other recommended dotfiles for Spring Boot + optional front-end projects generated by this skill.

## Contents
- [Quick Checklist](#quick-checklist-)
- [`.gitignore`](#gitignore)
- [`.env` & `.env.sample`](#env--envsample)
- [`.editorconfig`](#editorconfig)
- [`.gitattributes`](#gitattributes)
- [`.dockerignore`](#dockerignore)
- [DevContainer Setup](#devcontainer-setup)
- [Optional dotfiles & folders](#optional-dotfiles--folders)
- [How the generator handles these](#how-the-generator-handles-these)
- [Validation](#validation)
- [References](#references)

## Quick Checklist ✅

- **.gitignore** → include Java/Maven, IDEs, OS junk, Testcontainers, Docker, Node/Vite outputs, `.env*`
- **.env.sample** → committed, documents required variables; actual `.env` ignored
- **.editorconfig** → enforce indentation, charset, LF endings, trim trailing whitespace
- **.gitattributes** → normalize line endings, mark binary files, improve diffs
- **.dockerignore** → keep Docker build context lean; exclude `target/`, `node_modules/`, `.git/`, etc.
- **.devcontainer/** (optional) → reproducible Dev Container with Java 25, Node 22, PostgreSQL
- **.vscode/** (optional) → recommended extensions/settings (Java, Spring, YAML, Docker)
- **.nvmrc / .node-version** (optional) → pin Node 22.x for front-end builds

---

## `.gitignore`

**Goals:** prevent committing build artifacts, sensitive files, and OS/IDE clutter. The skill ships an opinionated template; enrich if needed.

**Template highlights** (see `assets/gitignore`):

```gitignore
# Maven / Java
/target/
!.mvn/wrapper/maven-wrapper.jar
.mvn/timing.properties

# IDEs
*.iml
.idea/
.vscode/
*.classpath
*.project
*.settings/

# Logs & OS junk
logs/
*.log
.DS_Store
Thumbs.db

# Node/Vite frontend
frontend/node_modules/
frontend/dist/
frontend/.vite/
frontend/.eslintcache

# Testcontainers / Docker
.testcontainers.properties
**/.testcontainers/*
.docker/
*.pid

# Env files — keep .env.sample committed
!.env.sample

# Coverage / reports
coverage/
jacoco.exec
surefire-reports/
failsafe-reports/
cyclonedx-*.xml
dependency-check-report.*

# Env files
.env
.env.*
.env.local

# Native builds
**/*.exe
*.dll
*.so
/target/*-exec

# Misc
*.orig
*.rej
```

> **Tip:** Start.spring.io generates a minimal `.gitignore`; the generator scripts **append/merge** our template to ensure both Java and front-end ignores are covered.

---

## `.env` & `.env.sample`

- **Commit** `./.env.sample` with placeholder values and comments.
- **Never commit** `.env` (ignored via `.gitignore`).
- **Docker Compose** and `spring-boot-docker-compose` can load variables via `env_file: .env` entries.
- For CI, set secrets via the platform’s secret store (GitHub Actions `secrets`, Azure DevOps variable groups, etc.).

**Suggested `./.env.sample`:**

```dotenv
# Spring profiles
SPRING_PROFILES_ACTIVE=dev

# Database (PostgreSQL)
DATABASE_URL=jdbc:postgresql://localhost:5432/mydb
DATABASE_USERNAME=user
DATABASE_PASSWORD=change-me

# Testcontainers overrides (optional)
TESTCONTAINERS_RYUK_DISABLED=false

# Application secrets (NEVER commit real values)
APP_API_KEY=replace-me
APP_API_SECRET=replace-me
```

> **Local dev tip:** copy once → `cp .env.sample .env`, then update values. **Do not** check in `.env`.

---

## `.editorconfig`

Keeps formatting consistent across IDEs and languages. *(FYI: the standard filename is `.editorconfig`, not `.editorconf`.)*

**Recommended content:**

```ini
# top-most EditorConfig file
root = true

[*]
charset = utf-8
end_of_line = lf
insert_final_newline = true
indent_style = space
indent_size = 4
trim_trailing_whitespace = true
max_line_length = 120

[{*.yml,*.yaml}]
indent_size = 2

[{*.json,*.js,*.ts,*.tsx,*.vue,*.mjs,*.cjs}]
indent_size = 2

[{*.md,*.adoc}]
trim_trailing_whitespace = false

[Makefile]
indent_style = tab
```

> **Why:** Avoids whitespace churn in PRs; aligns Java (4 spaces) and front-end files (2 spaces).

---

## `.gitattributes`

Normalize line endings and improve diffs for certain file types.

```gitattributes
# Text normalization
* text=auto eol=lf

# Binary files
*.png binary
*.jpg binary
*.jar binary
*.gz binary
*.zip binary

# Improve diffs
*.md diff=markdown
*.adoc diff=asciidoc
*.java diff=java
*.kt diff=java
*.sql diff=sql
*.properties diff=java

# Keep scripts executable
scripts/*.mjs text eol=lf
scripts/create-project text eol=lf
```

> Ensures contributors on Windows/macOS/Linux don’t fight line endings.

---

## `.dockerignore`

Shrink Docker build context; speeds up builds and avoids leaking secrets.

```dockerignore
.git
.gitignore
node_modules
**/node_modules
frontend/dist
frontend/.vite
frontend/.eslintcache
.target
/target
.env
.env.*
.idea
.vscode
.DS_Store
**/*.log
coverage
```

> **Tip:** Also exclude `mvnw.cmd` if building inside Linux containers only.

---

## DevContainer Setup

A [Dev Container](https://containers.dev/) gives every contributor the same pre-configured environment — Java 25, Node 22, Maven, Docker-in-Docker, and a PostgreSQL sidecar — without installing anything locally beyond VS Code / GitHub Codespaces.

The skill ships two files in `assets/devcontainer/`; the generator copies them to `.devcontainer/` in the project root.

### `.devcontainer/devcontainer.json`

```jsonc
// Dev Container configuration for Spring Boot + optional front-end + PostgreSQL.
{
    "name": "Spring Boot Dev Environment",
    "dockerComposeFile": "docker-compose.yml",
    "service": "app",
    "workspaceFolder": "/workspaces/${localWorkspaceFolderBasename}",

    "features": {
        "ghcr.io/devcontainers/features/java:1": {
            "version": "25",
            "installMaven": "true"
        },
        "ghcr.io/devcontainers/features/node:1": {
            "version": "22"
        },
        "ghcr.io/devcontainers/features/docker-in-docker:2": {}
    },

    "customizations": {
        "vscode": {
            "extensions": [
                "vscjava.vscode-java-pack",
                "pivotal.vscode-spring-boot",
                "vmware.vscode-boot-dev-pack",
                "redhat.vscode-yaml",
                "ms-azuretools.vscode-docker",
                "dbaeumer.vscode-eslint",
                "esbenp.prettier-vscode"
            ],
            "settings": {
                "java.compile.nullAnalysis.mode": "automatic",
                "editor.formatOnSave": true,
                "files.eol": "\n"
            }
        }
    },

    "postCreateCommand": "./mvnw dependency:go-offline -q || true",
    "postStartCommand": "echo '✅ Dev container ready — run ./mvnw spring-boot:run'",

    "forwardPorts": [8080, 5173, 5432],
    "portsAttributes": {
        "8080": { "label": "Spring Boot",   "onAutoForward": "notify" },
        "5173": { "label": "Vite Dev Server","onAutoForward": "silent" },
        "5432": { "label": "PostgreSQL",     "onAutoForward": "silent" }
    },

    "remoteUser": "vscode"
}
```

**Key decisions:**

| Setting | Why |
|---------|-----|
| `dockerComposeFile` | Lets the container depend on a PostgreSQL service instead of requiring `spring-boot-docker-compose` to start one |
| `features/java` | Installs Eclipse Temurin 25 + Maven wrapper support |
| `features/node` | Installs Node 22 so `npm run dev` works for the front-end |
| `features/docker-in-docker` | Lets Testcontainers and `docker build` work inside the container |
| `postCreateCommand` | Pre-fetches Maven dependencies so the first build is fast |
| `forwardPorts` | Exposes the Spring Boot app (8080), Vite dev server (5173), and PostgreSQL (5432) |

### `.devcontainer/docker-compose.yml`

```yaml
services:
  app:
    image: mcr.microsoft.com/devcontainers/base:ubuntu
    volumes:
      - ..:/workspaces/${localWorkspaceFolderBasename}:cached
    command: sleep infinity
    depends_on:
      postgres:
        condition: service_healthy

  postgres:
    image: postgres:16-alpine
    restart: unless-stopped
    environment:
      POSTGRES_DB: mydb
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD", "pg_isready", "-U", "user"]
      interval: 10s
      timeout: 5s
      retries: 5
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
```

The `postgres` service mirrors the project's root `compose.yaml` so credentials stay consistent. The `app` service is a lightweight Ubuntu container that Dev Container features layer onto.

### Customising the DevContainer

- **No database needed?** Remove the `postgres` service from `docker-compose.yml`, remove `depends_on` from `app`, and delete port `5432` from `forwardPorts`.
- **No front-end?** Remove the `features/node` block and port `5173`.
- **Add Redis, Kafka, etc.?** Add the service to `docker-compose.yml` and a matching `forwardPorts` entry.
- **GitHub Codespaces**: works out of the box — push `.devcontainer/` and open the repo in Codespaces.

### Connecting the app to the DevContainer database

Because the `postgres` service runs as a sibling Docker Compose service, the app connects via `localhost:5432` — the same as local development. Use these properties (or set via `.env`):

```properties
spring.datasource.url=jdbc:postgresql://localhost:5432/mydb
spring.datasource.username=user
spring.datasource.password=password
```

> **Tip:** With `spring-boot-docker-compose` enabled, Spring Boot may try to start *another* PostgreSQL container from the project root `compose.yaml`. To avoid duplication inside the DevContainer, set `spring.docker.compose.enabled=false` in a `dev` profile or pass `-Dspring.docker.compose.enabled=false`.

---

## Optional dotfiles & folders

- **`.vscode/extensions.json`** (recommended):
  ```json
  {
    "recommendations": [
      "vscjava.vscode-java-pack",
      "pivotal.vscode-spring-boot",
      "redhat.vscode-yaml",
      "ms-azuretools.vscode-docker",
      "dbaeumer.vscode-eslint",
      "esbenp.prettier-vscode"
    ]
  }
  ```
- **`.vscode/settings.json`**: enable format-on-save, set Java code style, Prettier, ESLint, files.eol = "\n".
- **`.nvmrc` / `.node-version`**: set `22.14.0` (kept in `versions.json`).
- **`.mvn/wrapper`**: already provided by start.spring.io; keep `mvnw` executable.
- **`.prettierignore` / `.eslintignore`** (if front-end added): ignore generated assets and `target/`.
- **`.testcontainers.properties`** (optional): tune reuse, Docker host, etc. Keep it **ignored** if it contains sensitive overrides.
- **`.github/workflows/`** (CI): a starter GitHub Actions workflow is available at `assets/ci/github-actions.yml`. Copy it to `.github/workflows/ci.yml` in your project to get build, test, and Docker checks on every push.

---

## How the generator handles these

- After downloading the project from start.spring.io, the scripts **patch in** or **append**:
  - `.gitignore` (merged with template in `assets/gitignore`)
  - `.env.sample`
  - `.editorconfig`
  - `.gitattributes`
  - `.dockerignore`
  - optional `.vscode/` recommendations folder
  - optional `.devcontainer/` setup (`devcontainer.json` + `docker-compose.yml`)
- Existing files are **not overwritten blindly**:
  - If `.gitignore` exists, we append with a marker `# === dr-jskill additions ===`.
  - For other dotfiles, we create them only if missing.

> You can run the generator, inspect the created dotfiles, and tailor as needed for your team/CI policies.

---

## Validation

After project generation, verify:

1. `git status` is clean (no generated artifacts tracked)
2. `.env` is ignored (`git check-ignore -v .env`)
3. Editors honor `.editorconfig` (try saving a Java + JS file)
4. Docker build context excludes heavy folders (`docker buildx bake --print` to inspect context)
5. Line endings are LF (`git ls-files --eol | head`)

If any check fails, adjust the dotfiles and re-run the generator or update your global git settings.

## References

- [Dev Containers Specification](https://containers.dev/)
- [EditorConfig Specification](https://editorconfig.org/)
- [gitattributes Documentation](https://git-scm.com/docs/gitattributes)
- [gitignore Documentation](https://git-scm.com/docs/gitignore)
- [Docker .dockerignore Reference](https://docs.docker.com/build/building/context/#dockerignore-files)
- [Configuration Best Practices](CONFIGURATION.md) — secrets & env handling
- [Docker Deployment Guide](DOCKER.md) — Docker Compose & container workflows